[{
  "$resource": {
    "^url":"/api/{{params.entity}}/{{params.entitiyID}}"
  },
  "$parse": {
     "$compile":{
       "type":"section",
       "$parse":"self",
           "content": [
             {
               "type": "button-dropdown",
               "$parse":"self",
               "className": "btn-default",
               "icon": "fa fa-edit",
               "pull": "right",
               "title": "Click for options",
               "links": [
                 {
                   "content": {
                     "type": "rest-button",
                     "@links": "$resource.data.links",
                     "rel":"edit",
                     "anchor": true,
                     "textLabel": "Edit"
                   }
                 },
                 {
                   "content": {
                     "type": "button",
                     "name":"goToNewSpecimen",
                     "^href": "?patient={{state.model._id}}#/specimens/new",
                     "title": "Register a new specimen under this patient",
                     "anchor": true,
                     "target": "_blank",
                     "textLabel": "Register Specimen"
                   }
                 }
               ]
             },
             {
               "type": "btn-group",
               "className": "pull-right",
               "content": {
                 "type": "button",
                 "name": "/#/patients/new",
                 "className": "btn btn-success",
                 "title": "Create a new patient",
                 "icon": "fa fa-file-text-o",
                 "@onClick": "navigate"
               }
             },
             {
               "type": "section",
               "$parse":"self",
               "content": [
                 {
                   "type": "tabs",
                   "@onClick": "self.this",
                   "@currentTab": "state.view",
                   "stateKey": "view",
                   "tabs": [
                     {
                       "label": "General",
                       "tabKey": "LOAD_PATIENT",
                       "activeKey": "SHOW_PATIENT"
                     },
                     {
                       "label": "Specimens",
                       "tabKey": "LOAD_SPECIMENS",
                       "activeKey": "SHOW_SPECIMENS"
                     }
                   ]
                 },
                 {
                   "type": "panel",
                   "body": {
                     "type": "switch",
                     "@currentView": "state.view",
                     "defaultView": "LOAD_PATIENT",
                     "views": {
                       "LOAD_PATIENT": {
                         "type": "state-request",
                         "method": "get",
                         "url": "/api/patients/{{props.params.objectID}}",
                         "resultKey": "model",
                         "@parent": "this",
                         "@onError": "operationFailed",
                         "successState": "SHOW_PATIENT",
                         "stateKey": "view",
                         "loadLabel": "Loading patient data..."
                       },
                       "SHOW_PATIENT": {
                         "type": "view",
                         "content": [
                           {
                             "type": "section",
                             "className": "container-fluid",
                             "content": [
                               {
                                 "type": "panel",
                                 "body": [
                                   {
                                     "type": "dl",
                                     "@data": "state.model",
                                     "labels": [
                                       {
                                         "label": "Patient ID",
                                         "name": "patientID"
                                       },
                                       {
                                         "label": "First Name",
                                         "name": "name.first"
                                       },
                                       {
                                         "label": "Last Name",
                                         "name": "name.last"
                                       },
                                       {
                                         "label": "Date of Birth",
                                         "name": "dob",
                                         "filter": "date YYYY-MM-DD"
                                       },
                                       {
                                         "label": "Sex",
                                         "name": "sex"
                                       }
                                     ]
                                   }
                                 ]
                               },
                               {
                                 "type": "panel",
                                 "heading": "Address",
                                 "body": [
                                   {
                                     "type": "dl",
                                     "@data": "state.model",
                                     "labels": [
                                       {
                                         "label": "Street Line 1",
                                         "name": "address.street1"
                                       },
                                       {
                                         "label": "Street Line 2",
                                         "name": "address.street2"
                                       },
                                       {
                                         "label": "Town/City",
                                         "name": "address.town"
                                       },
                                       {
                                         "label": "State",
                                         "name": "address.state"
                                       },
                                       {
                                         "label": "Postal Code",
                                         "name": "address.code"
                                       },
                                       {
                                         "label": "Country",
                                         "name": "address.country"
                                       }
                                     ]
                                   }
                                 ]
                               },
                               {
                                 "type": "panel",
                                 "heading": "Contact",
                                 "body": [
                                   {
                                     "type": "dl",
                                     "@data": "state.model",
                                     "labels": [
                                       {
                                         "label": "Home",
                                         "name": "phone.home"
                                       },
                                       {
                                         "label": "Mobile",
                                         "name": "phone.mobile"
                                       },
                                       {
                                         "label": "Office",
                                         "name": "phone.office"
                                       },
                                       {
                                         "label": "Fax",
                                         "name": "fax"
                                       },
                                       {
                                         "label": "Email",
                                         "name": "email"
                                       }
                                     ]
                                   }
                                 ]
                               },
                               {
                                 "type": "panel",
                                 "heading": "Other Contact",
                                 "body": [
                                   {
                                     "type": "dl",
                                     "@data": "state.model",
                                     "labels": [
                                       {
                                         "label": "Name",
                                         "name": "other.name",
                                         "type": "name"
                                       },
                                       {
                                         "label": "Relationship",
                                         "name": "other.relationship"
                                       },
                                       {
                                         "label": "Phone",
                                         "name": "other.phone"
                                       },
                                       {
                                         "label": "Email",
                                         "name": "other.email",
                                         "type": "email"
                                       }
                                     ]
                                   }
                                 ]
                               }
                             ]
                           }
                         ]
                       },
                       "LOAD_SPECIMENS": {
                         "type": "state-request",
                         "method": "get",
                         "url": "/api/patients/{{props.params.objectID}}/specimens",
                         "resultKey": "specimens",
                         "@parent": "this",
                         "@onError": "operationFailed",
                         "successState": "SHOW_SPECIMENS",
                         "stateKey": "view",
                         "loadLabel": "Loading specimen data"
                       },
                       "SHOW_SPECIMENS": {
                         "type": "view",
                         "content": [
                           {
                             "type": "panel",
                             "className": "panel-default",
                             "table": {
                               "type": "table",
                               "@data": "state.specimens",
                               "columns": [
                                 {
                                   "label": "Number",
                                   "name": "specimenID",
                                   "filter": "snumber|link #/specimens/{{_id}}/profile"
                                 },
                                 {
                                   "label": "Patient",
                                   "name": "patient.name",
                                   "filter": "name|link #/patients/{{patient._id}}/profile"
                                 },
                                 {
                                   "label": "Institution",
                                   "name": "institution.name",
                                   "filter": "link #/institutions/{{institution._id}}/profile"
                                 },
                                 {
                                   "label": "Physician",
                                   "name": "physician.name",
                                   "filter": "name|link #/physicians/{{physician._id}}/profile"
                                 },
                                 {
                                   "label": "Date Received",
                                   "name": "dateReceived",
                                   "filter": "date ll"
                                 }
                               ]
                             }
                           }
                         ]
                       }
                     }
                   }
                 }
               ]
             }


           ]
         }
     }
  },


{
  "type": "view",
  "content": [


  ]
}
]