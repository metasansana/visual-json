<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: directives/ParseDirective.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: directives/ParseDirective.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Utils from '../core/Utils';
import ParseAndCompileInSameBlockError from './ParseAndCompileInSameBlockError';

/**
 * ParseDirective handles a `$parse` directive.
 *
 * The work of this directive is limited to scaning for and calling other directives.
 * Directives found are handled in this order:
 * 1. $resource
 * 2. $set
 * 3. $request
 * 4. $parse | $compile
 *
 * A `$parse directive must have a $parse or a $compile but not both!
 * In the case of an embedded $parse, this $parse SHOULD have a `$compile` or
 * some `$parse` that has a `$compile` in its ancestors.
 *
 * In other words, the work of a compiler MUST end with a $compile.
 */
class ParseDirective {

    constructor(order, provider) {
        this.order = order;
        this.provider = provider;
    }

    _hasParseAndCompile(tree) {

        return (tree.hasOwnProperty('$compile')) &amp;&amp; (tree.hasOwnProperty('$parse'))


    }

    _hasParseOrCompile(tree) {

        return (tree.hasOwnProperty('$compile')) || (tree.hasOwnProperty('$parse'));

    }

    apply(tree, scope) {

        var ret = null;

        if (this._hasParseAndCompile(tree)) throw new ParseAndCompileInSameBlockError(tree);
        if (!this._hasParseOrCompile(tree)) tree = {$compile: tree};

        this.order.slice().forEach(function ($) {

            if (tree.hasOwnProperty($)) {

                if ($ === '$parse')
                    return ret = this.apply(tree[$], scope);

                if ($ === '$compile')
                    return ret = this.provider.getDirectiveByName('$compile').
                        apply(tree[$], scope);

                this.provider.getDirectiveByName($).apply(tree[$], scope);
            }

        }.bind(this));

        return ret;

    }

    applyWithResource(tree, scope, done) {

        var schedule = this.order.slice();
        var directives = this.provider;

        schedule.unshift('$resource');

        if (this._hasParseAndCompile(tree)) throw new ParseAndCompileInSameBlockError(tree);
        if (!this._hasParseOrCompile(tree)) tree = {$compile: tree};

        var next = function () {

            var $ = schedule.shift();

            if (!$) throw new
                Error('ParseDirective: Reached end of directive order with no $compile section! JSON: ' +
                JSON.stringify(tree));

            if (tree.hasOwnProperty($)) {

                if ($ === '$parse')
                    return this.applyWithResource(tree[$], scope, done);

                if ($ === '$compile')
                    return done(directives.getDirectiveByName('$compile').apply(tree[$], scope));

                if ($ === '$resource')
                    return directives.getDirectiveByName($).apply(tree[$], scope, next);

                directives.getDirectiveByName($).apply(tree[$], scope);

            }

            next();

        }.bind(this);

        next();

    }

}

export default ParseDirective</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CompileDirective.html">CompileDirective</a></li><li><a href="Environment.html">Environment</a></li><li><a href="ES2015Error.html">ES2015Error</a></li><li><a href="ParseDirective.html">ParseDirective</a></li><li><a href="RequestDirective.html">RequestDirective</a></li><li><a href="ResourceDirective.html">ResourceDirective</a></li><li><a href="Scope.html">Scope</a></li><li><a href="SetDirective.html">SetDirective</a></li><li><a href="SymbolParser.html">SymbolParser</a></li><li><a href="UnknownDirectiveError.html">UnknownDirectiveError</a></li><li><a href="UnknownTypeError.html">UnknownTypeError</a></li><li><a href="Utils.html">Utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Sun Jul 12 2015 16:49:19 GMT-0400 (AST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
